/**
 * Created by efe.sozen on 25.07.2016.
 */

(function(){
    "use strict";

  angular
    .module('app.config',[]);

})();

/**
 * Created by efe.sozen on 25.07.2016.
 */
(function(){
    "use strict";

  angular
    .module('app.config')
    .config(appConfig);
  
  appConfig.$inject = ['$stateProvider', '$urlRouterProvider', '$ionicConfigProvider'];
  
  function appConfig($stateProvider, $urlRouterProvider,$ionicConfigProvider) {
    $urlRouterProvider.otherwise('/')
    $ionicConfigProvider.backButton.previousTitleText(false).text('');
    $stateProvider
      .state('home', {
        url: '/',
        templateUrl: 'views/home.html',
        controller:'HomeCtrl as vm'
      })
      .state('cards', {
        url: '/cards',
        templateUrl: 'views/cards.html',
        controller:'CardsCtrl as vm'
      })
      .state('places', {
        url: '/places:searchText',
        templateUrl: 'views/places.html',
        controller:'PlacesCtrl as vm'
      })
      .state('venueDetail', {
        url: '/venueDetail:id',
        templateUrl: 'views/venueDetail.html',
        controller:'VenueDetailCtrl as vm'
      })
      .state('foods', {
        url: '/foods',
        templateUrl: 'views/foods.html',
        controller:'FoodCtrl as vm'
      })
      .state('foodDetail', {
        url: '/foodDetail:name',
        templateUrl: 'views/foodDetail.html',
        controller:'FoodDetailCtrl as vm'
      })
  }

})();

/* Created by efe.sozen on 25.07.2016.*/

(function(){
  "use strict";

  angular
    .module('app.services',[]);

})();


/**
 * Created by efe.sozen on 26.07.2016.
 */
(function(){
  "use strict";

  angular
    .module('app.services')
    .factory('CardsService',CardsService);

  CardsService.$inject = ['$firebaseArray', '$firebaseObject'];

  var cards = [{
    name : 'Lahmacun',
    path : 'img/foods/lahmacun.jpg'
  },
    {
      name : 'Köfte',
      path : 'img/foods/kofte.jpg'
    },
    {
      name : 'Hamburger',
      path : 'img/foods/hamburger.jpg'
    },
    {
      name : 'Pizza',
      path : 'img/foods/pizza.jpg'
    },
    {
      name : 'Çiğ Köfte',
      path : 'img/foods/cigkofte.jpg'
    },
    {
      name : 'Tantuni',
      path : 'img/foods/tantuni.jpg'
    },
    {
      name : 'Kokoreç',
      path : 'img/foods/kokorec.jpg'
    },
    {
      name : 'İskender',
      path : 'img/foods/iskender.jpg'
    },
    {
      name : 'Sandviç',
      path : 'img/foods/sandvic.jpg'
    },
    {
      name : 'Döner',
      path : 'img/foods/doner.jpg'
    }
  ]; 

  function CardsService($firebaseArray,$firebaseObject) {

    var db = "https://whateatapp.firebaseio.com/cards";
    var ref = new Firebase(db);
    var shownCards = [];
    
    var getCards = function(index,successCallBack){
    /*  var a = true;
      var lastKnownKey = null;
      var firstQuery = ref.orderByKey().limitToFirst(100);
      firstQuery.once('value', function(snapshot) {
        snapshot.forEach(function(childSnapshot) {
          lastKnownKey = childSnapshot.key();
          if(a){
            if (shownCards.indexOf(lastKnownKey) === -1) {
              var childRed = ref.child(lastKnownKey);
              childRed.on("value", function (snapshot) {
                var card = snapshot.val();
                shownCards.push(lastKnownKey);
                successCallBack(card);
              });
              a = false;
            }
          }
        });
      });*/

      
     // ref.on("value", function(snapshot) {
     //   var cardList = snapshot.val();
     //   successCallBack(cardList);
     // }, function (errorObject) {
     //   console.log("The read failed: " + errorObject.code);
     // });

      successCallBack(cards);
    };

    return {
      getCards:getCards
    }

  }

})();

/**
 * Created by efe.sozen on 27.07.2016.
 */
(function () {
    "use strict";

    angular
        .module('app.services')
        .factory('FoodService', FoodService);

    var foods = [{
        name: 'Bulgur Pilavı',
        path: 'img/foods/bulgurpilavi.jpg',
        materials: [
            '1 kase pilavlık bulgur',
            '2 adet domates',
            '1 adet soğan',
            '2 adet sivri biber',
            '1 su bardağı tavuk suyu',
            '1 su bardağı sıcak su (tavuk suyu da kullanabilirsiniz)',
            '2 yemek kaşığı sıvı yağ',
            'Tuz'
        ],
        description: 'Bulgur pilavı için öncelikle soğanları ince kıyın, sıvı yağ ile hafif kavurun, üzerine doğranmış sivribiberi ekleyin, biraz daha kavurduktan sonra rende domatesi ekleyin, iyice kavurun. Bulguru ekleyerek 1-2 dakika kavurun ve sıcak tavuk suyunu ve sıcak suyu ekleyin.  Tuzunu da ilave ederek bir kez karıştırın kapağını kapatın. Kısık ateşte suyu çekene kadar karıştırmadan pişirin. Ocağı kapattıktan sonra kapağın altına havlu kağıt koyarak 10 dakika kadar dinlendirin. Bulgur Pilavımız servise hazır, afiyet olsun. '
    },
        {
            name: 'Çıtır Tavuk',
            path: 'img/foods/citirtavuk.jpg',
            materials: [
                'Tavuk göğsü',
                'Çıtır pane harcı',
                'Yarım su bardağı süt',
                '1 yumurta',
                'Tuz'
            ],
            description: 'Tavuk göğsü ince bir şekilde dilimlenir. Yumurta, süt ve tuz çırpılarak dilimlenen tavuk göğsü bu sosta yaklaşık 1 saat kadar buzdolabında bekletilir. Vaktiniz yoksa bekletmeyebilirsiniz ancak bekletirseniz tavuklar marine olduğu için daha yumuşak ve lezzetli olacaktır. Pane harcına bulanan tavuklar bol kızgın yağda kızartılır. Pişen tavuklar fazla yağını çekmesi için havlu kağıt üzerine alınır. Çıtır tavuklarınız servise hazır, şimdiden afiyet olsun.'
        },
        {
            name: 'Domates Çorbası',
            path: 'img/foods/domatescorba.jpg',
            materials: [
                '4-5 adet olgun domates',
                '2 çorba kaşığı tereyağı',
                '1 çorba kaşığı un',
                '1 su bardağı süt',
                '1 çorba kaşığı rendelenmiş taze kaşar'
            ],
            description: 'Domates çorbası yapmak için yağ ve un bir tencerede hafifçe kavrulur. Diğer taraftan kabuğu çıkarılıp, küp küp kesilmiş domates robottan geçirilip bu karışıma ilave edilir, birkaç dakika kavrulur. Ara verilmeden bir litre kadar su ilave edilip karıştırma işlemi sürdürülür.15 dakika bu şekilde kaynatılır. Daha sonra süt ilave edilip bir kaç dakika daha kaynatılarak ocaktan alınır. Arzu edildiği kadar tuz konur ve servis yaparken üzerine kaşar peyniri rendesi ilave edilir. Domates çorbamız servise hazır, afiyet olsun.'
        },
        {
            name: 'Enginar',
            path: 'img/foods/enginar.jpg',
            materials: [
                '6 adet enginar',
                '1 adet havuç',
                '1 adet patates',
                '1 su bardağı bezelye (haşlanmış ya da konserve)',
                '1 adet soğan',
                '1 çay bardağı zeytinyağı',
                '1 adet limon',
                '1 çay kaşığı şeker',
                'Tuz',
                '1 su bardağı su'
            ],
            description: 'Havuç minik küp şeklinde doğranır, üzeri geçecek kadar su eklenerek haşlanmaya bırakılır. Kaynadıktan 5 dk kadar sonra minik küpler halinde doğranan patates eklenir ve sebzeler hafif yumuşayana kadar kaynatılır. Tam pişmemesi önemli. Soğan yemeklik doğranarak yarım çay bardağı zeytinyağında hafif pembeleşene kadar kavrulur. Üzerine patates ve havuç eklenir. 1 su bardağı bezelye de ilave edilerek karıştırılır, ocaktan alınır. Enginarlar limon ile ovularak tencereye dizilir. Üzerine hazırlanan sebzeler dökülür. Şeker, tuz ve yarım çay bardağı zeytinyağı gezdirilir. 1 su bardağı sıcak su eklenerek tencerenin kapağı kapatılır. Enginarlar yumuşayana kadar pişirilir. Soğuduktan sonra servis edilir. Afiyet olsun'
        },
        {
            name: 'Et Sote',
            path: 'img/foods/etsote.jpg',
            materials: [
                '500 gr sotelik et',
                '1 adet büyük soğan',
                '3-4 adet sivri biber',
                '2-3 adet domates',
                'Maydanoz',
                'Yarım yemek kaşığı tereyağı',
                'Zeytinyağı',
                'Kekik, pul biber, karabiber, tuz'
            ],
            description: 'İlk olarak soğanı küp küp doğrayıp yağda kavuruyoruz. Sonra etleri ekleyip karıştırmaya devam ediyoruz. Biraz soteledikten sonra baharatları, biber ve domatesi, maydanozu ilave edip karıştırıyoruz. Etlerin üzerine gelecek kadarda su ilave edip pişmeye bırakıyoruz.(Eğer isterseniz etleri önceden biraz haşlayabilirsiniz, daha kolaylık olur). Afiyet olsun.'
        },
        {
            name: 'İzmir Köfte',
            path: 'img/foods/izmirkofte.jpg',
            materials: [
                'Köfte için gerekli malzemeler',
                '500 gram az yağlı kıyma',
                '1 adet kuru soğan',
                '1 adet yumurta',
                'Yarım demet maydanoz',
                '1,5 su bardağı bayat ekmek içi',
                'Karabiber, Kırmızı pul biber, kekik, tuz',
                'Diğer Malzemeler',
                '4 adet domates (3 adedi sosu için , 1 adedi de üzerine dilimlemek için)',
                '4 adet patates',
                '3 adet çarliston biber',
                '1 tatlı kaşığı salça (tercihen karışık)',
                'Sıvı yağ (Kızartmak için)'
            ],
            description: 'Ekmek içini ve arkasından soğanı rondo dan geçiriyoruz (isterseniz rendeleyip ufalayabilirsiniz). Yumurtayı, ince ince doğranmış maydanozu, baharatları ve kıymayı da ekleyip iyice yoğuruyoruz. Parmak uzunluğunda ince ve uzun bir şekil verip biraz dinlenmesi için tabağa sıralıyoruz. Patatesleri soyup, elma dilimi şeklinde kesiyoruz. Sıvı yağı iyice kızdırıp (çok yağ çekmesin diye) önce patatesleri arkasından da köfteleri azıcık kızartıyoruz. Tepsiye bir patates bir köfte şeklinde sıralıyoruz. Köftelerden sonra kızartma yağından bir kepçe sos tenceremize alıyoruz, salçamızı da ekleyip iyice karıştırıyoruz. Arkasından rendelediğimiz 3 adet domatesi de ekleyip 10 dakika pişmeye bırakalım, isterseniz sarımsak ekleyebilirsiniz. Kekik ve tuzunu da ekledikten birkaç dakika sonra ocaktan alıyoruz. Hazırlanan sosu patates ve köftelerin üzerine hepsine değecek şekilde döküyoruz ki pişerken kurumasın. Üzerine 1 adet soyulup dilimlenmiş domatesi sıralıyoruz, biberleri de kesip içini temizledikten sonra aralarına yerleştiriyoruz. Fırına atmadan önce tepsinin kenarından 1 çay bardağı sıcak su koyup önceden ısıtılmış fırında patateslerin üzeri kızarana kadar pişiriyoruz.  30. dakikadan sonra açıp, tepsinin içindeki sostan köftelerin ve patateslerin üzerine biraz gezdirebilirsiniz. İzmir köftemiz servise hazır, afiyet olsun.'
        },
        {
            name: 'Kuru Fasülye',
            path: 'img/foods/kurufasulye.jpg',
            materials: [
                '2 su bardağı kuru fasulye',
                '1 adet soğan',
                '1 yemek kaşığı salça',
                '1 tatlı kaşığı kırmızı tatlı toz biber',
                '3-4 yemek kaşığı sıvı yağ',
                'Tuz',
                'Oda sıcaklığında su'
            ],
            description: 'Fasulyeleri akşamdan iyice yıkayıp sıcak suyla ıslatın. Ertesi gün soğanı yemeklik doğrayın. Sıvı yağda kavurun. Salçayı ekleyip kokusu çıkana kadar kavurun. Toz biberi ekleyip karıştırın. Suyunu süzdüğünüz fasulyeleri ekleyin ve karıştırın. Düdüklü tencere için üzerini 1 parmak geçecek kadar su ekleyip kapağını kapatın ve buharı çıkmaya başladıktan sonra 20 dk pişirin. Normal tencere için üzerini 4 parmak geçecek kadar su ekleyip kısık ateşte fasulyeler yumuşayana kadar pişirin. Tuzunu ekleyip karıştırın. Kuru fasülyemiz servise hazır, afiyet olsun. '
        },
        {
            name: 'Sarma',
            path: 'img/foods/sarma.jpg',
            materials: [
                '500 gram tokat yaprağı (salamura)',
                '1 adet limon',
                'Zeytinyağı',
                'İç harcı için',
                '2 orta boy kuru soğan',
                '1,5 su bardağı pirinç',
                'Maydanoz',
                '1 yemek kaşığı salça',
                'Karabiber',
                'Kırmızı pul biber',
                'Kimyon',
                'Nane',
                'Tuz',
                '2 yemek kaşığı sıvı yağ'
            ],
            description: 'Öncelikle salamura yapraklar 2-3 dakika sıcak suda bekletilir, yıkanır ve süzgece alınır. Geniş bir kabın içerisine soğanlar rendelenir, üzerine zeytinyağı dökülür. Pirinç yıkanarak  kabın içerisine eklenir. Baharatlar, salça ve tuzu da ilave edildikten sonra ince kıyılmış maydanoz da eklenerek karıştırılır. Yaprağın geniş kısmına iç harçtan konulur ve rulo gibi iki yanlardan kapatarak sarılır. Bu işleme yaprak bitene kadar devam edilir. Sarılan yaprakların üzerine zeytinyağı ve limon dilimleri ekleyip yaklaşık 5-6 su bardağı kadar da sıcak su ilave edilerek kısık ateşte pişirilir. Üzerine sarmalar dağılmasın diye tencere kapağından biraz küçük ebatta bir kase kapatılır. Yaprak sarmamız servise hazır, afiyet olsun. '
        },
        {
            name: 'Soslu Makarna',
            path: 'img/foods/soslumakarna.jpg',
            materials: [
                '1 paket istenen çeşitte makarna',
                'Makarnayı haşlamak için su ve tuz',
                'Domates sosu için;',
                '2-3 yemek kaşığı sıvı yağ (veya zeytinyağı)',
                '1 adet kuru soğan',
                'Varsa 4-5 yemek kaşığı yazdan hazırlanmış domates sosu ya da 3-4 adet taze domates',
                'Tuz',
                'Karabiber',
                'Taze kekik (isteğe bağlı)',
                '1-2 diş sarımsak (isteğe bağlı)'
            ],
            description: 'Öncelikle pişirmek istediğiniz makarna, paketinde yazan tarife göre bol tuzlu suda haşlanmaya bırakılır. Makarnalar haşlanırken domates sosu için genişçe bir tavaya sıvı yağ alınır. İnce doğranmış soğanlar eklenerek birkaç dakika kavrulur. Daha sonra hazır domates sosundan 4-5 yemek kaşığı kadar ilave edilir. Hazır domates sosunuz yoksa 3-4 adet taze domatesin kabuklarını soyup küçük küçük doğradıktan sonra soğanlarla beraber pişirebilirsiniz. Bu durumda domatesler iyice ezilip suyunu çekene kadar sosunuzu kaynatmalısınız. Ayrıca 1-2 diş doğranmış sarımsak da ilave edilebilir. Domates sosu kaynayıp kıvam aldıktan sonra karabiber, tuz ve varsa tazesinden kekik eklenir. Kaynayan makarnanın haşlama suyundan da 1-2 kepçe kadar sosa ilave edilir. Sos hazır olduktan ve makarnalar da pişip suyu süzüldükten sonra birbirine karıştırılır. Dilerseniz sosun tamamını makarna ile karıştırmadan önce bir kısmını ayırıp servis esnasında makarnanın üzerine de 1-2 kaşık bırakabilirsiniz. Domates soslu makarnamız servise hazır, şimdiden afiyet olsun.'
        },
        {
            name: 'Taze Fasülye',
            path: 'img/foods/tazefasulye.jpg',
            materials: [
                'Yarım kg taze fasulye',
                '2 adet domates',
                '1 adet kuru soğan',
                'Kırmızı pul biber',
                '1,5 yemek kaşığı salça',
                'Karabiber',
                'Zeytinyağı',
                'Tuz'
            ],
            description: 'Taze fasulyeleri yıkadıktan sonra ayıklayıp doğrayalım. Düdüklü tencerenin içerisine zeytinyağı gezdirelim. Kuru soğan doğrayalım, soğanlar kavrulduktan sonra salçayı, doğranmış domatesi, taze fasulyeyi ve baharatları ilave edelim. 5-6 dakika kısık ateşte kavuralım. Yaklaşık 3 su bardağı kadar su ilave edelim ve düdüklü tencerenin kapağını kapatalım. 15 dakika pişirelim. Afiyet olsun. '
        }
    ];

    function FoodService() {

        var getFoods = function (index, successCallBack) {
            successCallBack(foods);
        };

        return {
            getFoods: getFoods
        }

    }

})();

/**
 * Created by efe.sozen on 25.07.2016.
 */

(function(){
  "use strict";

  angular
    .module('app.services')
    .factory('FoursquareService',FoursquareService); 

  FoursquareService.$inject = ['$http'];

  function FoursquareService($http){
    var apiUrl          = 'https://api.foursquare.com/v2/',
      clientId        = '0WT1LGBA2MSIWL2KRMKWXZSQRZVMJTIWCUCM20H3XAPAAUHF',
      clientSecret    = 'JC5GEVHZWSXOKSORYTRKVLECCKSCQUAR01L5TWU5N4TGQC5Q',
      v               = '20160322';

    var searchVenue = function(searchText,location, success){
      $http({
        url: apiUrl + 'venues/explore?',
        method: "GET",
        params: {
          client_id: clientId,
          client_secret: clientSecret,
          v: v,
          ll:location,
          llAcc: 3000.0,
          query: searchText,
          radius:2500

        }
      })
        .success(function(data) {
          success(data);
        });
    }

    var getVenue = function(venueId, success){
      $http({
        url: apiUrl + 'venues/' + venueId,
        method: "GET",
        params: {
          client_id: clientId,
          client_secret: clientSecret,
          v: v
        }
      })
        .success(function(data) {
          success(data);
        });
    }


    var getMenu = function(venueId,success){
      $http({
        url: apiUrl + 'venues/' + venueId + '/menu',
        method: "GET",
        params: {
          client_id: clientId,
          client_secret: clientSecret,
          v: v
        }
      })
        .success(function(data) {
          success(data);
        });
    }

    return {
      searchVenue: searchVenue,
      getVenue: getVenue,
      getMenu:getMenu
    }
  }

})();

/**
 * Created by efe.sozen on 25.07.2016.
 */
(function(){
  "use strict";

  angular.module('app.controllers',[]);

})();


/**
 * Created by efe.sozen on 26.07.2016.
 */

(function(){
  "use strict";

  angular
    .module('app.controllers')
    .controller('CardsCtrl',CardsCtrl);

  CardsCtrl.$inject = ['$state', 'CardsService', '$ionicLoading'];

//TODO: fonksiyonlar düzenlenecek
  function CardsCtrl($state,CardsService,$ionicLoading){
    var vm = this;
    var cards = [];
    var shownCards = [];

    vm.card = {};
    vm.changeCards = changeCard;
    vm.selectCard = selectCard;

    init();

    /******* functions *********/

    function init(){
      getCards();
    }

    function selectCard(card){
      $state.go('places',{ searchText:card});
     
    }
    
    function changeCard() {
      getCards();
    }

    function changeCards() {
      var card = cards[Math.floor(Math.random()*cards.length)];
      if(shownCards.indexOf(card) === -1){
        vm.card = card;
        shownCards.push(card);
      }
      else{
        changeCards();
      }

      if(shownCards.length == cards.length){
        /*Done*/
        resetCards();
      }
    }

    function resetCards() {
      shownCards = [];
      changeCards();
    }
    
    function getCard() {
      vm.card = {};
      $ionicLoading.show({
        template: 'Loading...'
      }).then(function(){
        //console.log("The loading indicator is now displayed");
      });
      CardsService.getCards(0,function (d) {
        vm.card = d;
        $ionicLoading.hide().then(function(){
          //console.log("The loading indicator is now hidden");
        });
      });
    }


    function getCards() {
      $ionicLoading.show({
        template: 'Loading...'
      }).then(function(){
        //console.log("The loading indicator is now displayed");
      });
      CardsService.getCards(1,function (d) {
       cards = d;
       changeCards();
        $ionicLoading.hide().then(function(){
         // console.log("The loading indicator is now hidden");
        });
      });
    }
  }
})();

/**
 * Created by efe.sozen on 25.07.2016.
 */
(function(){
  "use strict";

  angular
    .module('app.controllers')
    .controller('HomeCtrl',HomeCtrl);

  HomeCtrl.$inject = ['$state', '$ionicPopup'];

  function HomeCtrl($state,$ionicPopup) {
    var vm = this;

    vm.title = 'Hello World';
    vm.whatEat = whatEat; 
    vm.whatCook = whatCook;

    vm.whatEatImg = "img/neyesem_back.png";
    vm.whatCookImg = "img/nepisirsem_back.png";
    vm.centerLogoImg = "img/center_logo.png";

    function whatEat(){
      $state.go('cards')
    }

    function whatCook () {
      $state.go('foods')
    }

  }

})();



/**
 * Created by efe.sozen on 26.07.2016.
 */
(function () {
    "use strict";

    angular
        .module('app.controllers')
        .controller('PlacesCtrl', PlacesCtrl);

    PlacesCtrl.$inject = ['FoursquareService', '$stateParams', '$state', '$cordovaGeolocation', '$ionicLoading'];

    function PlacesCtrl(FoursquareService, $stateParams, $state, $cordovaGeolocation, $ionicLoading) {
        var vm = this;
        var searchText = '';
        vm.venues = [];
        vm.title = '';
        vm.getVenue = getVenue;

        var posOptions = {timeout: 10000, enableHighAccuracy: false};
        $cordovaGeolocation
            .getCurrentPosition(posOptions)
            .then(function (position) {
                var location = position.coords.latitude + ',' + position.coords.longitude;
                searchVenue(location);
            }, function (err) {
                // error
            });

        function searchVenue(location) {
            if ($stateParams) {
                searchText = $stateParams.searchText;
                vm.title = searchText;
                $ionicLoading.show();
                FoursquareService.searchVenue(searchText, location, function (data) {
                    var response = data.response;
                    angular.forEach(response.groups[0].items, function (v) {
                        //if (v.venue.hours && v.venue.hours.isOpen) { //if you want listing all venues do comment this line
                            if (v.venue.hours) { //uncomment for all venues
                            if (v.venue.rating) {
                                v.venue.rating = v.venue.rating.toFixed(1);
                                v.venue.location.distance = parseFloat((v.venue.location.distance / 1000).toFixed(1));
                                vm.venues.push(v);
                            }
                        }
                    })
                    // vm.venues = response.groups[0].items;//response.venues;
                    $ionicLoading.hide();
                })
            }
        }


        function getVenue(venueId) {
            $state.go('venueDetail', {id: venueId});
        }

    }

})();

/**
 * Created by efe.sozen on 26.07.2016.
 */
(function(){
  "use strict";

  angular
    .module('app.controllers')
    .controller('VenueDetailCtrl',VenueDetailCtrl);

  VenueDetailCtrl.$inject = ['FoursquareService', '$stateParams', '$ionicLoading'];

  function VenueDetailCtrl(FoursquareService,$stateParams,$ionicLoading){
    var vm = this;

    vm.venue = {};

    if($stateParams){
      var id = $stateParams.id;
      $ionicLoading.show();
      FoursquareService.getVenue(id,function(data){
        vm.venue = data.response.venue;

        if (vm.venue.photos.groups[0]) {
          vm.venue.thumbnail = vm.venue.photos.groups[0].items[0].prefix + '40x40' + vm.venue.photos.groups[0].items[0].suffix;
          vm.venue.photo = vm.venue.photos.groups[0].items[1].prefix + '300x300' + vm.venue.photos.groups[0].items[1].suffix;
        }

        $ionicLoading.hide();
        if(vm.venue.contact.phone)
          vm.showPhone = vm.venue.contact.phone.replace('+90','').replace(/(\d\d\d)(\d\d\d)(\d\d\d\d)/, "($1) $2 $3");

        if(vm.venue.location.city)
          vm.showState = vm.venue.location.city + " / " + vm.venue.location.state;
        //console.log(data.response.venue);
      });

      FoursquareService.getMenu(id,function(data) {
        //console.log('menu : ' + data); menu data 
      });
    }



    vm.openLink = function (link) {
      window.open(link, '_system');
    };

  }

})();

/**
 * Created by efe.sozen on 26.07.2016.
 */
(function(){
  "use strict";

  angular
    .module('app.controllers')
    .controller('FoodCtrl',FoodCtrl);

  FoodCtrl.$inject = ['$state', 'FoodService', '$ionicLoading'];

  function FoodCtrl($state,FoodService,$ionicLoading) {
    var vm = this;
    var cards = [];
    var shownCards = [];

    vm.card = {};
    vm.changeCards = changeCard;
    vm.selectCard = selectCard;

    init();

    /******* functions *********/

    function init(){
      getCards();
    }

    function selectCard(card){
      $state.go('foodDetail',{ name:card});

    }

    function changeCard() {
      getCards();
    }

    function changeCards() {
      var card = cards[Math.floor(Math.random()*cards.length)];
      if(shownCards.indexOf(card) === -1){
        vm.card = card;
        shownCards.push(card);
      }
      else{
        changeCards();
      }

      if(shownCards.length == cards.length){
        /*Done*/
        resetCards();
      }
    }

    function resetCards() {
      shownCards = [];
      changeCards();
    }

    function getCard() {
      vm.card = {};
      $ionicLoading.show({
        template: 'Loading...'
      }).then(function(){
       // console.log("The loading indicator is now displayed");
      });
      FoodService.getFoods(0,function (d) {
        vm.card = d;
        $ionicLoading.hide().then(function(){
         // console.log("The loading indicator is now hidden");
        });
      });
    }


    function getCards() {
      $ionicLoading.show({
        template: 'Loading...'
      }).then(function(){
       // console.log("The loading indicator is now displayed");
      });
      FoodService.getFoods(1,function (d) {
        cards = d;
        changeCards();
        $ionicLoading.hide().then(function(){
        //  console.log("The loading indicator is now hidden");
        });
      });
    }
  }

})();

/**
 * Created by efe.sozen on 26.07.2016.
 */
(function(){
  "use strict";

  angular
    .module('app.controllers')
    .controller('FoodDetailCtrl',FoodDetailCtrl);

  FoodDetailCtrl.$inject = ['$stateParams', 'FoodService', '$ionicLoading'];

  function FoodDetailCtrl($stateParams,FoodService,$ionicLoading) {

    var vm = this;
    if($stateParams) {
      var name = $stateParams.name;
      
      $ionicLoading.show();
      FoodService.getFoods(0,function (d) {
        $ionicLoading.hide().then(function(){
          
          angular.forEach(d,function (v,k) {
            if(v.name===name){
              vm.food = v;
            }
          });
        });
      });
    }
  }

})();

(function(){
  "use strict";

  angular.module('whatEatApp', [
    'ionic',
    'firebase',
    'ngCordova',
    'app.config',
    'app.services',
    'app.controllers'
  ])


   .run(runBlock);

  runBlock.$inject = ['$ionicPlatform', '$ionicPopup'];

  function runBlock($ionicPlatform,$ionicPopup) {
    $ionicPlatform.ready(function() {
      if(window.cordova && window.cordova.plugins.Keyboard) {
        // Hide the accessory bar by default (remove this to show the accessory bar above the keyboard
        // for form inputs)
        cordova.plugins.Keyboard.hideKeyboardAccessoryBar(true);

        // Don't remove this line unless you know what you are doing. It stops the viewport
        // from snapping when text inputs are focused. Ionic handles this internally for
        // a much nicer keyboard experience.
        cordova.plugins.Keyboard.disableScroll(true);
      }
      if(window.StatusBar) {
        StatusBar.styleDefault();
      }

      if(window.Connection) {
        if(navigator.connection.type == Connection.NONE) {
          var alertPopup = $ionicPopup.alert({
            title: 'Uyarı',
            template: 'İnternet bağlantısı bulunamadı.',
            okText: 'Tamam',
          });

          alertPopup.then(function(res) {
            //alert("there is no connection");
            ionic.Platform.exitApp();
          });
        }

        cordova.plugins.diagnostic.isLocationEnabled(function(enabled) {
          if(!enabled){
            var confirmPopup = $ionicPopup.confirm({
              title: 'Uyarı',
              template: 'Bu uygulama için konum ayarlarınızı açmanız gerekiyor. Konum açılsın mı?',
              okText: 'Evet',
              okType: 'button-energized',
              cancelText: 'Hayır',
            });

            confirmPopup.then(function(res) {
              if(res) {
                cordova.plugins.diagnostic.switchToLocationSettings();
              } else {
                ionic.Platform.exitApp();
              }
            });
          }
        }, function(error) {
          // alert("The following error occurred: " + error);
          ionic.Platform.exitApp();
        });
      }
    });
  }

})();
